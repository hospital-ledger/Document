# 医疗数据

Medical Data

## Abstract

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据区块链平台的架构设计，利用Hyperledger Fabric多链特点对数据进行结构设计，数据存储分为三个部分，存储数据、输出数据和查找验证数据。存储数据分为主要数据（包括全部文字数据和影像数据的Hash摘要）、摘要数据（重要文字数据和Hash摘要）和影像数据；数据输出需要根据不同场景的需求设计，包括面向普通用户数据、面向院方数据和对公数据；查找和验证数据（主链数据）。这部分主要是对这些数据的结构设计描述文档。

## 数据设计

### 存储数据

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;存储数据部分分为主要数据、摘要数据和影像数据三个部分。主要数据和影像数据设计在院际组织和普通用户组织内分别设计通道进行数据存储广播背书，院方对普通用户的数据没有修改写入权限，普通用户没有修改写入权限，确保数据不易被篡改；而影像数据部分，采取云端备份的方法进行存储，在院方组织和普通用户组织内均进行数据备份，读取时，使用Hash摘要进行验证读取。

1. 主要数据：存储全部的医疗数据和病例数据，提供相对完全且准确的数据记录。由于区块链存储数据量较大，将影像等占据存储空间较大的数据进行Hash摘要存储，以备调取对应数据时进行正确性验证。数据在院方组织和普通用户组织均进行背书。
2. 摘要数据：根据医学院同学提供的数据重要程度列表对院方节点提供的数据进行筛选，将重要指标数据和其他数据的Hash摘要以JSON键值对的形式进行存储，以备调取数据时进行正确性验证。数据在院方组织和普通用户组织均进行背书。
3. 影像数据：存储全部的医疗数据、病例数据和影像数据，提供最全面的相对准确的数据记录，信息的安全级别相对低。数据在院方提交节点、院方特定的备份节点首先进行备份，然后将数据由医疗数据区块链存储服务传输给普通用户组织，在普通用户组织内由对应的普通用户和该组织的特定备份节点备份。

### 输出数据

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;输出数据部分分为普通用户数据、院方数据和对公数据三个部分，这一部分的数据和存储数据是一致的，针对于不同的需求进行读取。

1. 普通用户数据：对应的用户节点进行本地读取，将时间戳、对应院方Hash、病例内容通过在主链的查找验证Hash后转化为可读性内容，经由医疗数据区块链存储服务传输给用户客户端。
2. 院方数据：根据用户提供的信息，经由医疗数据区块链存储服务在主链进行查找验证找到对应的普通用户节点，优先读取对应的主要数据，经过主链Hash验证后将结果返回给院方客户端。由医疗数据区块链存储服务提供临时连接，以便加快读取效率，为后期读取其他数据提供途径。
3. 对公数据：对其他组织进行数据统计等工作提供的数据，这些数据是匿名的，且只提供关键数据的读取，除需要统计的医疗数据以外，其他数据均以加密形式提供。

### 查找和验证数据

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在程序的设计中，主链上存储普通用户的Hash验证。主链分为用户ID链、用户Hash琏、查询记录链、写入记录链和院方Hash链，主要提供信息验证的作用。

1. 用户ID链：通过已通过认证的可信任组织将用户提供的ID转化为加密的Hash ID，存储在一条公共链上，在院方调取患者数据的时候，首先将患者提供的ID经过医疗数据区块链存储服务在主链上查找对应的Hash ID，服务将根据对应的ID中的组织信息找到患者对应的组织，以便读取数据，确保数据读取过程保密，对应的读取操作将会写入主链的查询记录链，记录信息读取记录，降低恶意读取数据行为的发生风险。
2. 用户Hash链：在每次更新过普通用户的医疗数据信息后，将时间戳、院方数据Hash和普通用户对应的数据Hash进行记录，确保在信息读取时的准确性。普通用户节点的当前状态与用户Hash链的用户数据Hash同步。
3. 查询记录链：记录时间戳、院方信息、普通用户Hash ID、查询信息的相关Hash信息。
4. 写入记录链：记录时间戳、院方信息、普通用户Hash ID、写入或修改信息的相关Hash信息。
5. 院方Hash链：记录服务内所有院方节点的ID，其当前状态定义为其是否具有写入数据的权限，在信息写入时先验证提请节点的当前状态是否允许其进行写入操作。

## 权限设置

| Organization           | Authority                                    |
| ---------------------- | -------------------------------------------- |
| 院方节点               | 写入用户医疗数据、读取用户医疗数据           |
| 普通用户节点           | 读取个人数据、读取公链查询记录链和写入记录链 |
| 认证的可信任组织       | 写入用户ID/修改用户状态                      |
| 其他组织               | 读取加密数据（对公数据）                     |
| 医疗数据区块链存储服务 | 读取/写入公链验证信息、调取用户数据          |



## 数据设计开发时序

| Data                           | Estimated Time |
| ------------------------------ | -------------- |
| 用户数据（主要数据、摘要数据） | 2020.09.10     |
| 院方数据（主要数据、摘要数据） | 2020.09.20     |
| 查找和验证数据（主链数据）     | 2020.09.30     |
| 输出数据                       | 2020.10.10     |
| 影像数据                       | 2021.02.28     |



## 用户ID信息与院方信息记录

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;认证的可信任组织可以创建新的用户ID，并且调用医学数据区块链存储服务为对应的普通用户在指定的用户组织中创建新的普通用户节点，由医学数据区块链存储服务维护公链中用户Hash链。认证的可信任组织可以同样创建院方节点，并调用医学数据区块链存储服务在对应的院方组织中创建新的节点，主链的院方Hash由医学数据区块链存储服务维护。院方组织内部的Hash链在组织通道内维护。

## 数据写入的过程

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;医学数据区块链存储服务的数据写入权限只提供给医院和其他的可信任机构。对于医院这个主要的部分而言，由医院的设备提供医疗数据，由医院的医生（节点）提供病例数据，这些数据将会被划分成摘要中提及的三个数据存储的类型。首先是主要数据和摘要数据，这个部分数据在医院组织内由数据提供节点提交，在排序节点排序后由背书节点进行广播背书，由医学数据区块链存储服务将数据传输到普通用户（节点）对应的组织的数据接收节点，由该节点进行数据提交，在排序节点排序后由该组织的背书节点进行广播背书。医学数据区块链存储服务读取院方节点写入的数据，将记录写入到主链的写入记录链中。

## 数据输出的过程

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据提供的ID信息，由医学数据区块链存储服务在主链上查询对应的组织信息和节点信息，由医学数据区块链存储服务读取数据，根据不同的数据读取请求来源返回数据。

## 数据验证的过程

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;医学数据区块链存储服务将读取到的信息进行Hash计算，并与主链中对应的Hash值进行比较，确保被验证信息的正确性。

## 数据安全性

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;医学数据区块链存储服务采用Hyperledger Fabric框架，院方组织和用户组织分别维护数据信息，记录修改和查询情况，可以有效降低数据被篡改的风险。根据主链中的Hash数据进行验证，以确保信息的原始性。

## 方法摘要

1. 开发方法：项目开发使用敏捷方法进行，快速制定计划，根据细节进行完善，系统设计从小而简单开始，逐步完善系统设计的结构。确保当前需求能够满足，并保持设计简明扼要，后期进行代码重构，合理化结构并集成。

2. 项目团队：开发团队共5人，Yutong Jin, Hailong Yu,  Wenchang Gao, Chengju Jiao, Yajie wen. Yutong Jin是队长，并且负责密码学相关内容，Hailong Yu主要负责文档、储存架构设计、Hyperledger Fabric开发和应用层开发，Chengju Jiao 主要负责储Hyperledger Fabric开发和应用层开发，Wenchang Gao主要负责网络层TCP / IP、应用层开发和数据分析，Yajie Wen为软件设计医疗数据结构提供医学相关知识和建议并提供一些医疗数据供以进行测试。

3. 变更控制：根据医学院提供的数据和需求对初步计划进行完善，根据开发的实际情况对项目内容进行更改，初步完成项目后进行代码重构，完善功能和合理化架构。在初步完成前，代码修改进行日志记录，记录问题和对应解决方案。

4. 项目工具：

   | 任务     | 工具                   |
   | -------- | ---------------------- |
   | 文档管理 | Sphinx / Readthedocs   |
   | 代码管理 | GitHub / GitLab        |
   | 文件管理 | Onerive / Gitee        |
   | 项目网站 | GitHub Page            |
   | 服务器群 | Huawei / Tencent Cloud |
   | 代码检查 | Huawei Devcloud        |

## 工作流程和预估时间

| Step  | Description                               | Estimated Time    |
| ----- | ----------------------------------------- | ----------------- |
| 0     | 需求分析与整体设计                        | 30天 (2020.02.17) |
| 1     | Hyperledger Fabric快速开发工具            |                   |
| 1.1   | Linux(Ubuntu 18.04.3 LTS / Cent OS 7)学习 | 10天 (2020.02.27) |
| 1.2   | Hyperledger Fabric学习和TCP / IP          | 20天 (2020.03.18) |
| 1.3   | Hyperledger Fabric实际部署与测试          | 30天 (2020.04.17) |
| 1.4   | Hyperledger Fabric快速集成开发工具开发    | 62天 (2020.06.18) |
| 2     | Hyperledger Fabric架构设计开发            |                   |
| 2.1   | 架构设计与网络设计开发                    | 20天 (2020.09.30) |
| 2.2   | 应用层开发与测试                          | 40天 (2020.10.20) |
| 2.3   | 数据测试                                  | 10天 (2020.11.30) |
| 3     | 代码重构与完善                            |                   |
| 3.1   | 优化组织间逻辑架构和应用结构              | 30天 (2021.02.28) |
| 3.2   | 优化数据结构和安全性                      | 60天 (2021.04.30) |
| 4     | 后期                                      |                   |
| 4.1   | 数据分析与后期处理                        | 60天 (2021.06.30) |
| Total |                                           | 370天             |

## 预计成果

| Document       | Description                            | Date       |
| -------------- | -------------------------------------- | ---------- |
| 快速开发工具   | Hyperledger Fabric网络快速部署工具     | 2020.06.18 |
| 项目Demo       | 初步开发的区块链医疗数据存储系统       | 2020.11.30 |
| MDBCSP稳定版本 | 重构代码合理化架构的区块链数据存储系统 | 2021.04.30 |
| 数据分析       | 项目对成果进行数据分析的版本           | 2021.06.30 |

## 时间表

| Quarter | Task                                            | Issues |
| ------- | ----------------------------------------------- | ------ |
| 2020-1  | 需求分析、学习Linux和Hyperledger Fabric基础知识 | 3      |
| 2020-2  | Hyperledger Fabric部署测试与开发快速开发工具    | 3      |
| 2020-3  | MDBCSP架构设计开发与网络设计开发                | 2      |
| 2020-4  | 应用层开发与测试                                | 2      |
| 2021-1  | 代码重构与完善                                  | 1      |
| 2021-2  | 结构优化与安全性优化                            | 2      |
| 2021-3  | 数据分析与后期处理                              | 2      |
| 2021-4  | 其他后期工作                                    | 1      |
